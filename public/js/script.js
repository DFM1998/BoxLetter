function buttonDirectionClicked(t){handleShowMap(),$(".list_location_open").hide(),$(".list_location_close").show(),$("#location_"+t+" .list_location_close").hide(),$("#location_"+t+" .list_location_open").show(),document.getElementById("location_"+t).scrollIntoView({behavior:"smooth",block:"center",inline:"center"})}const horraire=["07:30","08:00","08:30","09:00","09:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00"];let mydata=JSON.parse(data),curMap=new lux.Map({target:"map1",bgLayer:"basemap_2015_global",bgLayerStyle:mydata,zoom:14,position:[76825,75133]});function displayMyPosition(t,e){curMap.showMarker({position:[t,e],positionSrs:4326,positioning:"center-center",iconURL:"./images/myPosition.svg",click:!1});var i=ol.proj.fromLonLat([t,e]);curMap.getView().animate({center:i,duration:1e3,zoom:15})}function moveView(t){var e=ol.proj.fromLonLat([parseFloat(t.split(",")[0]),parseFloat(t.split(",")[1])]);console.log(curMap),curMap.getView().animate({center:e,duration:2e3,zoom:18})}function clearMap(){curMap.getOverlays().clear()}function displayPins(t,e,i,o){clearMap(),$.getJSON("api/boxletter/"+t,(function(t){for(let n=0;n<t.length;n++){const a=t[n];let s=a.coordinates.split(",");const c=a.idBoxLetter,r=a.pickUpTime,d=a.street,p=a.city,u=a.postal;if(void 0!==e){let a=horraire.indexOf(e),h=horraire.length;void 0!==i&&(h=horraire.indexOf(i)+1);const g=t[n];for(let t=a;t<h;t++)if(null==o){if(g.pickUpTime==horraire[t]){var l='<div><div style="display: ruby-text;"><i class="fa-regular fa-clock fa-2xl" style="color: #002641"></i></div><div style="display: inline-block;margin-left: 10px;"><p class="timePopup">'+r+'</p><p class="smallTitle">Pickup time</p></div><hr style="margin-left: -14px; margin-right:-14px;"></div><div style="margin-top:10px;"><div style="display: ruby-text;"><i class="fa-solid fa-map-location-dot fa-2xl" style="color: #002641"></i></div><div style="display: inline-block;margin-left:10px;"><p class="streetPopup" style="line-height: 12px;">'+d+"<br>L-"+u+" "+p+'</p><p class="smallTitle">Street</p></div><hr style="margin-left: -14px; margin-right:-14px;"></div><div style="margin: auto;border: 0;"><button class="directionButton" id="boxLetter_'+c+'" onclick="buttonDirectionClicked('+c+')">Direction</button></div>';curMap.showMarker({position:[parseFloat(s[0]),parseFloat(s[1])],positioning:"center-center",iconURL:"./images/pin.svg",click:!0,html:l,style:function(t,e){return iconStyle.getImage().setScale(1/Math.pow(e,1/3)),iconStyle}})}}else if(g.pickUpTime==horraire[t]&&g.pickUpTime==horraire[t]&&parseFloat(calcCrow(g.normalCoordinates.split(",")[1],g.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2))<=parseInt(o)){l='<div><div style="display: ruby-text;"><i class="fa-regular fa-clock fa-2xl" style="color: #002641"></i></div><div style="display: inline-block;margin-left: 10px;"><p class="timePopup">'+r+'</p><p class="smallTitle">Pickup time</p></div><hr style="margin-left: -14px; margin-right:-14px;"></div><div style="margin-top:10px;"><div style="display: ruby-text;"><i class="fa-solid fa-map-location-dot fa-2xl" style="color: #002641"></i></div><div style="display: inline-block;margin-left:10px;"><p class="streetPopup" style="line-height: 12px;">'+d+"<br>L-"+u+" "+p+'</p><p class="smallTitle">Street</p></div><hr style="margin-left: -14px; margin-right:-14px;"></div><div style="margin: auto;border: 0;"><button class="directionButton" id="boxLetter_'+c+'" onclick="buttonDirectionClicked('+c+')">Direction</button></div>';curMap.showMarker({position:[parseFloat(s[0]),parseFloat(s[1])],positioning:"center-center",iconURL:"./images/pin.svg",click:!0,html:l,style:function(t,e){return iconStyle.getImage().setScale(1/Math.pow(e,1/3)),iconStyle}})}}else{l='<div><div style="display: ruby-text;"><i class="fa-regular fa-clock fa-2xl" style="color: #002641"></i></div><div style="display: inline-block;margin-left: 10px;"><p class="timePopup">'+r+'</p><p class="smallTitle">Pickup time</p></div><hr style="margin-left: -14px; margin-right:-14px;"></div><div style="margin-top:10px;"><div style="display: ruby-text;"><i class="fa-solid fa-map-location-dot fa-2xl" style="color: #002641"></i></div><div style="display: inline-block;margin-left:10px;"><p class="streetPopup" style="line-height: 12px;">'+d+"<br>L-"+u+" "+p+'</p><p class="smallTitle">Street</p></div><hr style="margin-left: -14px; margin-right:-14px;"></div><div style="margin: auto;border: 0;"><button class="directionButton" id="boxLetter_'+c+'" onclick="buttonDirectionClicked('+c+')">Direction</button></div>';curMap.showMarker({position:[parseFloat(s[0]),parseFloat(s[1])],positioning:"center-center",iconURL:"./images/pin.svg",click:!0,html:l,style:function(t,e){return iconStyle.getImage().setScale(1/Math.pow(e,1/3)),iconStyle}})}}$(".ol-overlay-container").click((function(){console.log(this.id)}))}))}let longitude=6.130578,latitude=49.611205,check=!0;const handleShowMap=()=>{$("aside").toggleClass("mobileViewShow"),$("aside").toggleClass("mobileViewHide"),check?($(".showMapButton").html('<i class="fa-solid fa-list"></i>'),check=!1):($(".showMapButton").html('<i class="fa-solid fa-map-location-dot"></i>'),check=!0)};$(document).on("click",".directionButton",handleShowMap),$(document).ready((function(){$(".languageButton").click((function(){switchLanguage(this.id),"en"==this.id&&localStorage.clear(),location.reload(!0)})),$(".directionButton").each((function(){var t=$(this).text();$(this).text(t)}))}));let lang="";if(null!=localStorage.getItem("language")){const t=localStorage.getItem("language");$("#"+t).html("EN"),$("#en").html(t.toUpperCase()),$("#"+t).attr("id","en"),switchLanguage(t)}else switchLanguage("en");function switchLanguage(t){$.ajax({url:"js/json/"+t+".json",dataType:"json",async:!1}).done((function(e){lang=e,localStorage.setItem("language",t),$("#emptiedYet").html(lang.emptiedYet),$("#time").html(lang.time),$("#distance").html(lang.distance),$("#from").html(lang.from),$("#to").html(lang.to),$("#sortBy").html(lang.sortBy),$("#boxLettersFound").html(lang.boxLettersFound)}))}let sorting="asc";function calcCrow(t,e,i,o){var l=toRad(i-t),n=toRad(o-e),a=(t=toRad(t),i=toRad(i),Math.sin(l/2)*Math.sin(l/2)+Math.sin(n/2)*Math.sin(n/2)*Math.cos(t)*Math.cos(i));return 6371*(2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a)))}function toRad(t){return t*Math.PI/180}$("#sortByPickUp").click((function(){$(this).css("background-color","#E1E1E1"),$("#sortByDistance").css("background-color","");let t=$("#startTime").val(),e=$("#endTime").val(),i=$(".sliderDistance").val(),o="pickUpTime",l=$("#inputFieldSearch").val();null!==t&&(t="07:30",e="19:00"),null!==e&&(e="19:00"),""!==l?$.getJSON("https://apiv3.geoportail.lu/geocode/search?queryString="+l,(function(l){showLocationList(l.results[0].AddressDetails.locality,t,e,i,o,sorting)})):showLocationList("Luxembourg",t,e,i,o,sorting),sorting="asc"==sorting?"desc":"asc"})),$("#sortByDistance").click((function(){$(this).css("background-color","#E1E1E1"),$("#sortByPickUp").css("background-color","");let t=$("#startTime").val(),e=$("#endTime").val(),i=$(".sliderDistance").val(),o="distance",l=$("#inputFieldSearch").val();null!==t&&(t="07:30",e="19:00"),null!==e&&(e="19:00"),""!==l?$.getJSON("https://apiv3.geoportail.lu/geocode/search?queryString="+l,(function(l){showLocationList(l.results[0].AddressDetails.locality,t,e,i,o,sorting)})):showLocationList("Luxembourg",t,e,i,o,sorting),sorting="asc"==sorting?"desc":"asc"})),checkInputSearch(),$(document).ready((function(){let t="<option selected disabled>??:??</option>";horraire.forEach((e=>{t+="<option>"+e+"</option>"})),$("#startTime").html(t)})),$("#startTime").change((function(){let t=this.value,e="<option selected disabled>??:??</option>";for(let i=horraire.indexOf(t);i<horraire.length;i++){e+="<option>"+horraire[i]+"</option>"}$("#endTime").html(e),checkInputSearch(t,"19:00")})),$("#endTime").change((function(){checkInputSearch($("#startTime").val(),this.value)})),$("#inputFieldSearch").keyup((function(t){let e=$(this).val();""!==e?$.getJSON("https://apiv3.geoportail.lu/fulltextsearch?limit=2&layer=Commune&query="+e,(function(t){let i="";for(let e=0;e<t.features.length;e++){const o=t.features[e].properties.label;console.log(o),i+="<li>"+o+"</li>"}$.getJSON("https://apiv3.geoportail.lu/fulltextsearch?limit=5&layer=Adresse&query="+e,(function(t){console.log(t.features);for(let e=0;e<t.features.length;e++){const o=t.features[e].properties.label;console.log(o),i+="<li>"+o+"</li>"}$("#autoCompleteDivList").html(i),$("#autoCompleteDivList li").click((function(){const t=$(this).html();console.log(t),$("#inputFieldSearch").val(t),$(".searchIcon").click(),$("#autoCompleteDiv").hide()})),$("#autoCompleteDiv").show()}))})):$("#autoCompleteDiv").hide(),13==t.keyCode&&$(".searchIcon").click()})),$(".sliderDistance").on("change mousemove",(function(){$("#distanceValueDisplay").html(this.value)})),$(".resetDefault").click((function(){$("#inputFieldSearch").val(""),$("#checkBoxEmptied").prop("checked",!1),$(".sliderDistance").val("5"),$("#distanceValueDisplay").html("5"),$("#startTime").val("??:??").change(),$("#endTime").val("??:??").change()})),$("#checkBoxEmptied").click((function(){if($(this)[0].checked){let t=new Date,e=t.getHours(),i=t.getMinutes();i<30&&(i=30),i>30&&(i="00"),(e>19||e<7)&&(e=7,i=0);let o="";e<10?o="0"+e:o+=e,o+=":"+i,checkInputSearch(o,"19:00"),$("#startTime").val(o).change()}else checkInputSearch("07:30","19:00"),$("#startTime").val("??:??").change()}));let kmDistance="5";$(".sliderDistance").on("change",(function(){if(kmDistance!=this.value){let t="07:30",e="19:00",i=$("#startTime").val();if(null!==i){t=i;let o=$("#endTime").val();null!==o&&(e=o)}checkInputSearch(t,e,this.value),kmDistance=this.value}})),$(".showMapButton").click(handleShowMap);let checkListLocation=!0,firstRun=!0,count=0;function showLocationList(t,e,i,o,l,n){$.getJSON("/api/boxletter/"+t,(function(t){"pickUpTime"==l&&("asc"==n?t.sort(((t,e)=>t.pickUpTime>e.pickUpTime?1:e.pickUpTime>t.pickUpTime?-1:0)):t.sort(((t,e)=>t.pickUpTime<e.pickUpTime?1:e.pickUpTime<t.pickUpTime?-1:0))),"distance"==l&&("asc"==n?t.sort(((t,e)=>calcCrow(t.normalCoordinates.split(",")[1],t.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2)>calcCrow(e.normalCoordinates.split(",")[1],e.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2)?1:calcCrow(e.normalCoordinates.split(",")[1],e.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2)>calcCrow(t.normalCoordinates.split(",")[1],t.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2)?-1:0)):t.sort(((t,e)=>calcCrow(t.normalCoordinates.split(",")[1],t.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2)<calcCrow(e.normalCoordinates.split(",")[1],e.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2)?1:calcCrow(e.normalCoordinates.split(",")[1],e.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2)<calcCrow(t.normalCoordinates.split(",")[1],t.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2)?-1:0)));let a="";count=0;for(let l=0;l<t.length;l++)if(null!=e){let n=horraire.indexOf(e),s=horraire.length;void 0!==i&&(s=horraire.indexOf(i)+1);const c=t[l];for(let t=n;t<s;t++){let e='\n                    <span class="list_location_all" id="location_'+c.idBoxLetter+'">\n                    <div class="list_location_close">\n                        <span class="pickupTime">\n                        '+lang.pickUpTime+'<br>\n                        <span class="time">'+c.pickUpTime+'</span>\n                        </span>\n                        <span class="pickupAddress">\n                        '+lang.address+'<br>\n                        <span class="address">'+c.street+" <br>L-"+c.postal+" "+c.city+'</span>\n                        </span>\n                        <span class="pickupDistance">\n                        '+lang.distance+'<br>\n                        <span class="distance">'+calcCrow(c.normalCoordinates.split(",")[1],c.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2)+' km</span>\n                        </span>\n                    </div>\n                    <div class="list_location_open" hidden>\n                        <table style="width: 100%;border-collapse: collapse;">\n                        <tr style="border-bottom: 0.2px solid #9B9B9B">\n                            <td style="text-align:center;width: 25%;">\n                                <i class="fa-regular fa-clock" style="font-size: 30px"></i>\n                            </td>\n                            <td>\n                                <span style="font-size: 35px;">'+c.pickUpTime+'</span>\n                            </td>\n                        </tr>\n                        <tr style="border-bottom: 0.2px solid #9B9B9B">\n                            <td style="text-align: center;">\n                                <i class="fa-solid fa-map-location-dot" style="font-size: 30px"></i>\n                            </td>\n                            <td>\n                                <span style="font-size: 18px;line-height: 18px;font-family: RajdhaniRegular;"><p>'+c.street+"</p><p>L-"+c.postal+" "+c.city+'</p></span>\n                            </td>\n                        </tr>\n                        <tr style="border-bottom: 0.2px solid #9B9B9B">\n                            <td style="text-align: center;">\n                                <i class="fa-solid fa-location-arrow" style="font-size: 30px"></i>\n                            </td>\n                            <td>\n                                <span>'+calcCrow(c.normalCoordinates.split(",")[1],c.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2)+' km</span>\n                            </td>\n                        </tr>\n                        <tr>\n                            <td colspan=\'2\' style="text-align:center;">\n                                <button class="directionButton directButtonDisplayOnMap" value="'+c.normalCoordinates+'" style="width: 60%; font-size: 20px;margin-top:5px;" >Direction</button>\n                            </td>\n                        </tr>\n                        </table></div></span>';null==o?c.pickUpTime==horraire[t]&&(count++,a+=e):c.pickUpTime==horraire[t]&&parseFloat(calcCrow(c.normalCoordinates.split(",")[1],c.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2))<=parseInt(o)&&(count++,a+=e)}}else{count++;const e=t[l];a+='\n                        <span class="list_location_all" id="location_'+e.idBoxLetter+'">\n                        <div class="list_location_close">\n                            <span class="pickupTime">\n                            '+lang.pickUpTime+'<br>\n                            <span class="time">'+e.pickUpTime+'</span>\n                            </span>\n                            <span class="pickupAddress">\n                            '+lang.address+'<br>\n                            <span class="address">'+e.street+" <br>L-"+e.postal+" "+e.city+'</span>\n                            </span>\n                            <span class="pickupDistance">\n                            '+lang.distance+'<br>\n                            <span class="distance">'+calcCrow(e.normalCoordinates.split(",")[1],e.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2)+' km</span>\n                            </span>\n                        </div>\n                        <div class="list_location_open" hidden>\n                            <table style="width: 100%;border-collapse: collapse;">\n                            <tr style="border-bottom: 0.2px solid #9B9B9B">\n                                <td style="text-align:center;width: 25%;">\n                                    <i class="fa-regular fa-clock" style="font-size: 30px"></i>\n                                </td>\n                                <td>\n                                    <span style="font-size: 35px;">'+e.pickUpTime+'</span>\n                                </td>\n                            </tr>\n                            <tr style="border-bottom: 0.2px solid #9B9B9B">\n                                <td style="text-align: center;">\n                                    <i class="fa-solid fa-map-location-dot" style="font-size: 30px"></i>\n                                </td>\n                                <td>\n                                    <span style="font-size: 18px;line-height: 18px;font-family: RajdhaniRegular;"><p>'+e.street+"</p><p>L-"+e.postal+" "+e.city+'</p></span>\n                                </td>\n                            </tr>\n                            <tr style="border-bottom: 0.2px solid #9B9B9B">\n                                <td style="text-align: center;">\n                                    <i class="fa-solid fa-location-arrow" style="font-size: 30px"></i>\n                                </td>\n                                <td>\n                                    <span>'+calcCrow(e.normalCoordinates.split(",")[1],e.normalCoordinates.split(",")[0],latitude,longitude).toFixed(2)+' km</span>\n                                </td>\n                            </tr>\n                            <tr>\n                                <td colspan=\'2\' style="text-align:center;">\n                                    <button class="directionButton directButtonDisplayOnMap" value="'+e.normalCoordinates+'" style="width: 60%; font-size: 20px;margin-top:5px;" >Direction</button>\n                                </td>\n                            </tr>\n                            </table></div></span>'}$(".list_lo").html(a),$("#totalBoxLettersFound").html(count),$(".directButtonDisplayOnMap").click((function(){moveView(this.value)})),$(".list_location_all").click((function(){"none"!=$("#"+this.id+" .list_location_close").css("display")&&($(".list_location_open").hide(),$(".list_location_close").show(),$("#"+this.id+" .list_location_close").hide(),$("#"+this.id+" .list_location_open").show("slow"))}))}))}function success(t){$.getJSON("https://apiv3.geoportail.lu/geocode/reverse?lon="+t.coords.longitude+"&lat="+t.coords.latitude,(function(e){const i=e.results[0];let o=i.number+", "+i.street+" L-"+i.postal_code+" "+i.locality;$("#inputFieldSearch").val(o),displayPins(i.locality),showLocationList(i.locality),longitude=t.coords.longitude,latitude=t.coords.latitude,displayMyPosition(t.coords.longitude,t.coords.latitude)}))}function checkInputSearch(t,e,i){let o=$("#inputFieldSearch").val();""!==i?""!==o?$.getJSON("https://apiv3.geoportail.lu/geocode/search?queryString="+o,(function(o){const l=o.results[0].name;$("#inputFieldSearch").val(l),longitude=o.results[0].geomlonlat.coordinates[0],latitude=o.results[0].geomlonlat.coordinates[1],showLocationList(o.results[0].AddressDetails.locality,t,e,i),displayPins(o.results[0].AddressDetails.locality,t,e,i),displayMyPosition(longitude,latitude)})):(showLocationList("Luxembourg",t,e,i),displayPins("Luxembourg",t,e,i),displayMyPosition(longitude,latitude)):""!==o?$.getJSON("https://apiv3.geoportail.lu/geocode/search?queryString="+o,(function(i){const o=i.results[0].name;$("#inputFieldSearch").val(o),longitude=i.results[0].geomlonlat.coordinates[0],latitude=i.results[0].geomlonlat.coordinates[1],showLocationList(i.results[0].AddressDetails.locality,t,e),displayPins(i.results[0].AddressDetails.locality,t,e),displayMyPosition(longitude,latitude)})):(showLocationList("Luxembourg",t,e),displayPins("Luxembourg",t,e),displayMyPosition(longitude,latitude))}$(".showListTowns").click((function(){checkListLocation&&firstRun?($(this).css({"background-color":"#002641",color:"white"}),checkListLocation=!1,firstRun=!1,$(".list_location_all").hide(),$(".descriptionText").html(lang.filterbyTown),$.getJSON("/api/cities",(function(t){let e="<div class='filterTownDiv'><table style='width: 100%'>";e+="<tr><td style='width: 25%'></td><td style='width: 50%'>Select all:</td><td style='width: 25%'><input type='checkbox' id='checkBoxSelectAll'></td></tr>";for(let i=0;i<t.length;i++){const o=t[i];e+="<tr><td></td><td>"+o.city+"</td><td><input type='checkbox' class='townCheckBox' id='checkBoxIdCity_"+o.idCity+"' value='"+o.city+"'></td></tr>"}e+="</table></div>",$(".filterByTownContent").html(e),$("#checkBoxSelectAll").click((function(){this.checked?$(".townCheckBox").prop("checked",!0):$(".townCheckBox").prop("checked",!1);let t="";$(".townCheckBox:checkbox:checked").each((function(){t+=this.value+","})),""!=t?($("#checkBoxSelectAll")[0].checked&&(t=""),displayPins(t),showLocationList(t)):clearMap()})),$(".townCheckBox").click((function(){$(".townCheckBox:checkbox:checked").length>=t.length?$("#checkBoxSelectAll").prop("checked",!0):$("#checkBoxSelectAll").prop("checked",!1);let e="";$(".townCheckBox:checkbox:checked").each((function(){e+=this.value+","})),""!=e?($("#checkBoxSelectAll")[0].checked&&(e=""),displayPins(e),showLocationList(e)):clearMap()}))}))):checkListLocation?($(this).css({"background-color":"#002641",color:"white"}),checkListLocation=!1,$(".list_location_all").hide(),$(".filterByTownContent").show(),$(".descriptionText").html(lang.filterbyTown)):($(this).css({"background-color":"",color:"#002641"}),checkListLocation=!0,$(".list_location_all").show(),$(".filterByTownContent").hide(),$(".descriptionText").html('<span id="totalBoxLettersFound">'+count+"</span> "+lang.boxLettersFound+"</p>"))})),$(".pinSearchIconBar").click((function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(success):alert("Geolocation is not supported by this browser.")})),$(".searchIcon").click((function(){checkInputSearch()}));
